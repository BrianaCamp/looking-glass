<!doctype html>
<html class="no-js" lang="en">

    {% include head.html %}


    <body{% if page.body_class or layout.body_class %} class="{{ page.body_class }} {{ layout.body_class }}"{% endif %}>

        {% include analytics.html %}

        <main id="main" class="site-main">
            {{ content }}
            <canvas id="art-canvas" class="canvas"></canvas>
            <audio src="{{ page.audio-file }}"></audio>
        </main>

        {% comment %} {% include footer.html %} {% endcomment %}
        <script type="text/javascript">
            let canvasEl = document.querySelector('.canvas');
            const WIDTH = window.innerWidth;
            const HEIGHT = window.innerHeight;

            // SCENE
            const scene = new THREE.Scene();
            scene.background = new THREE.Color( 0x{{ page.background-color | remove: '#' }} );

            // CAMERA
            const camera = new THREE.PerspectiveCamera(75, WIDTH/HEIGHT, .01, 1000);
            camera.position.z = 6;
            camera.position.y = 1;
            camera.position.x = 1;

            // CONTROLS
            let controls = new THREE.OrbitControls( camera );
            controls.update();

            // RENDERER
            const renderer = new THREE.WebGLRenderer({ canvas: canvasEl, antialias: true, alpha: true});
            renderer.setSize(WIDTH, HEIGHT);

            // FLOOR
            let floorGeo = new THREE.PlaneBufferGeometry(200, 200, 9, 8);
            //let floorMaterial = new THREE.MeshBasicMaterial({ color: 0x{{ page.floor-color | remove: '#' }} });
            //let floor = new THREE.Mesh(floorGeo, floorMaterial);
            let floorMirror = new THREE.Reflector( floorGeo, {
                clipBias: 0.003,
                textureWidth: WIDTH * window.devicePixelRatio,
                textureHeight: HEIGHT * window.devicePixelRatio,
                color: 0xbcbaba,
                recursion: 1,
            });
            floorMirror.position.y = 0.5;
            floorMirror.rotateX( - Math.PI / 2 );
            scene.add(floorMirror);
            //scene.add(floor);

            //floor.rotateX( - Math.PI / 2);

            // LIGHTS
            let ambient = new THREE.AmbientLight( 0x{{ page.general-light-color | remove: '#' }} );
            scene.add( ambient );

            let directionalLight = new THREE.DirectionalLight( 0x{{ page.directional-light-color | remove: '#' }} );
            directionalLight.position.set( 0, 0, 5 ).normalize();
            scene.add( directionalLight );


            let mtlLoader = new THREE.MTLLoader();

            mtlLoader.load('{{ page.mtl-file }}', function(materials) {
            materials.preload();


            let objLoader = new THREE.OBJLoader();
            objLoader.setMaterials(materials);

            objLoader.load('{{ page.obj-file }}', function(object) {
                scene.add(object);
                object.position.y = -1;
                object.rotateY(10.9);

            },
            function ( xhr ) {

                    console.log( ( xhr.loaded / xhr.total * 100 ) + '% loaded' );

                },
                // called when loading has errors
                function ( error ) {

                    console.log( 'An error happened' );

                });

            });

            mtlLoader.setMaterialOptions({side: THREE.BackSide});

            controls.update();

            const render = function() {
                requestAnimationFrame(render);

                controls.update();

                renderer.render(scene, camera);
            };

            render();
        </script>

    </body>
</html>

